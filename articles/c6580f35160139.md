---
title: "deno-puppeteer ã¨ GitHub Actions ã§ LeetCode ã® ã‚¹ãƒˆãƒªãƒ¼ã‚¯ ã‚’READMEã«æ²è¼‰ã™ã‚‹"
emoji: "ğŸ¦•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["deno", "puppeter", "GitHubActions", "leetcode"]
published: false
---

æœ€è¿‘ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‹‰å¼·ã®ãŸã‚ã«ã€LeetCode ã‚’ 1 æ—¥ 1 å•è§£ã„ã¦ã„ã¾ã™ã€‚ä»Šæœãµã¨ LeetCode ã®ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ GitHub ã® README ã«è¼‰ã›ãŸã„ãªã¨æ€ã„ç«‹ã¡ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚

# ğŸ¦¾ ä½œã£ãŸã‚‚ã®

ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã« LeetCode ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã¨å›ç­”å•é¡Œæ•°ã®è¡¨ç¤ºã‚’ README.md ã«æ²è¼‰ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã‚Šã¾ã—ãŸã€‚

![](/images/c6580f35160139/2023-02-19-15-22-56.png)

ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

![](/images/c6580f35160139/2023-02-19-15-23-29.png)

:::message
Easy ã—ã‹ã»ã¼è§£ã„ã¦ã„ãªã„ã¨ã“ã‚ã«å®ŸåŠ›ãŒãŒãŒ... ğŸ¥¹
:::

# ğŸ› ï¸ ä»•çµ„ã¿

ä»•çµ„ã¿ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚
ä»¥ä¸‹ã®ä¸€è¦§ã®å‡¦ç†ã‚’ GitHub Actions ã® cron ã§å®šæœŸå®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

- LeetCode ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ç”»åƒã‚’æ’®å½±ã—ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
- README.md ã‚’æ›´æ–°
- å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ

ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦[ã“ã¡ã‚‰](https://github.com/kawamataryo/leetcode)ã«ã‚ã‚Šã¾ã™ã€‚

## 1. deno-puppeteer ã§ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±

LeetCode ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®æ’®å½±ã«ã¯ [deno-puppeteer](https://deno.land/x/puppeteer@16.2.0) ã‚’åˆ©ç”¨ã—ã€ã“ã¡ã‚‰ã®é–¢æ•°ã§è¡Œã£ã¦ã„ã¾ã™ã€‚

https://github.com/kawamataryo/leetcode/blob/main/scripts/lib/capturePage.ts#L3-L54

xpath ã§å¯¾è±¡ï¼ˆã‚¹ãƒˆãƒªãƒ¼ã‚¯ã¨ã€å›ç­”å•é¡Œã®è¦ç´ ï¼‰ã‚’æŒ‡å®šã—ã¦ã€ãã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã—ã€png ã¨ã—ã¦æŒ‡å®šã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚

:::message
è©²å½“è¦ç´ ã«ç‰¹åˆ¥æ„å‘³ã®ã‚ã‚‹ Class ã‚„ ID ãŒå­˜åœ¨ã—ãªã‹ã£ãŸãŸã‚ã€è¦ç´ ã®æŒ‡å®šã¯ xpath ã§ç„¡ç†ã‚„ã‚Šè¡Œã£ã¦ã„ã¾ã™ã€‚ LeetCode å´ã®ç”»é¢ã®å¤‰æ›´ã§ã™ãå‹•ã‹ãªããªã‚Šãã† ğŸ˜‡
:::

ãƒã‚¤ãƒ³ãƒˆã¯ã€é€šå¸¸ç”¨ã¨ dark ãƒ¢ãƒ¼ãƒ‰ç”¨ã® 2 æšã‚’æ’®å½±ã—ã¦ã„ã‚‹ç‚¹ã§ã™ã€‚

dark ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã¯[emulateMediaFeatures](https://pptr.dev/api/puppeteer.page.emulatemediafeatures)ã¨ã„ã† API ã§ã§ãã‚‹ã¨ã„ã†è¨˜äº‹ã‚‚ã‚ã£ãŸã®ã§ã™ãŒã€LeetCode ã®ç”»é¢ã®å ´åˆã€ãã‚Œã§ã¯ã†ã¾ãå‹•ã‹ãšã€html ã‚¿ã‚°ã®`dark`ã‚¯ãƒ©ã‚¹ã®ä»˜ã‘æ›¿ãˆã§è¡Œã£ã¦ã„ã¾ã™ã€‚

```ts:scripts/lib/capturePage.ts
await page.evaluate((html) => {
  html.classList.add("dark");
}, await page.$("html"));
await streakElement?.screenshot({ path: `images/${name}_dark.png` });
```

ã¾ãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®è§£åƒåº¦ã‚’ã‚ã’ã‚‹ãŸã‚å¤§ãã‚ã® viewport ã«ã—ã¦ã€ã•ã‚‰ã«[deviceScaleFactor](https://pptr.dev/api/puppeteer.viewport.devicescalefactor) ã‚’èª¿æ•´ã—ã¦ã„ã¾ã™ã€‚

```ts:scripts/lib/capturePage.ts
await page.setViewport({
  width: 1920,
  height: 1080,
  deviceScaleFactor: 2,
});
```

## 2. README ã®æ›´æ–°

README ã®æ›´æ–°ã¯ã“ã¡ã‚‰ã®é–¢æ•°ã§è¡Œã£ã¦ã„ã¾ã™ã€‚

https://github.com/kawamataryo/leetcode/blob/main/scripts/lib/updateReadme.ts#L3-L31

ã‚ã‚‰ã‹ã˜ã‚ README.md ã«è¨˜è¼‰ã—ã¦ãŠã„ãŸä»¥ä¸‹ã®ãƒãƒ¼ã‚«ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã€ç”»åƒã‚¿ã‚°ã¨æ›´æ–°æ—¥æ™‚ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ã£ã¦ç½®ãæ›ãˆã‚‹ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

```README.md
<!--START_SECTION:leetcode-streak-updated-time-->
<!--END_SECTION:leetcode-streak-updated-time-->
```

dark ãƒ¢ãƒ¼ãƒ‰ã§ç”»åƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«ã€`<picture>`ã‚¿ã‚°ã® media å±æ€§ã«`prefers-color-scheme`ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

```html:scripts/lib/capturePage.ts
<a href="https://leetcode.com/${user}/" target="_blank">
<picture>
  <source media="(prefers-color-scheme: dark)" srcset="./images/problems_dark.png" width="500">
  <img alt="" src="./images/problems.png" width="500">
</picture>
</a>
```

https://github.blog/changelog/2022-05-19-specify-theme-context-for-images-in-markdown-beta/

### 3. GitHub Actins ã§ã®å®šæœŸå®Ÿè¡Œ

1, 2 ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã€å®šæœŸå®Ÿè¡Œã—ã€å·®åˆ†ã‚’ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ GitHub Actions ã‚’ä½œã‚Šã¾ã™ã€‚

https://github.com/kawamataryo/leetcode/blob/main/.github/workflows/capture.yml#L1-L27

deno-puppeteer ã®å®Ÿè¡Œã®ãŸã‚ã® Chromium ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã€ãã®å¾Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

```yml:.github/workflows/capture.yml
- name: Install Puppeteer
  run: PUPPETEER_PRODUCT=chrome deno run -A --unstable https://deno.land/x/puppeteer@16.2.0/install.ts
- name: Capture streak
  run: PUPPETEER_PRODUCT=chrome deno task run
  env:
    LEET_CODE_USER_NAME: kawamataryo
```

å¤‰æ›´å·®åˆ†ã® Commit ã¯ã€[EndBug/add-and-commit](https://github.com/EndBug/add-and-commit)ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

default_author ã‚’`github_actions`ã¨ã™ã‚Œã°ã€å‹æ‰‹ã« bot ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚³ãƒŸãƒƒãƒˆã‚’ã—ã¦ãã‚Œã‚‹ã®ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã™ã­ã€‚

```yml:.github/workflows/capture.yml
- uses: EndBug/add-and-commit@v9
  with:
    default_author: github_actions
```

æœ€å¾Œã« 1 æ—¥ 1 å› GitHub Actions ã® cron ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚Œã°å®Œæˆã§ã™ã€‚

```yml:.github/workflows/capture.yml
on:
  push:
    branches:
      - main
  schedule:
    - cron:  '0 0 * * *'
```

# ãŠã‚ã‚Šã«

deno ã®é–‹ç™ºä½“é¨“ãŒç´ æ™´ã‚‰ã—ãæ€ã„ã®ã»ã‹ã‚µã‚¯ã‚µã‚¯é€²ã¿ã¾ã—ãŸã€‚
å¾Œã§æ™‚é–“ãŒã¨ã‚Œã‚Œã°ã€ã‚‚ã£ã¨æ‰‹è»½ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã† GitHub Actions ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä½œã‚Šç›´ã—ã€GitHub Marketplace ã«å…¬é–‹ã—ãŸã„ã§ã™ã€‚
