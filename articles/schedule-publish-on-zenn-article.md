---
title: "GitHub Actionã§Zennã®è¨˜äº‹äºˆç´„æŠ•ç¨¿ã‚’å®Ÿç¾ã™ã‚‹"
emoji: "ðŸ“†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GitHub", "GitHubAction", "zenn", "ci"]
published: true
---

ã€ŒZenn ã§è¨˜äº‹ã®äºˆç´„æŠ•ç¨¿ãŒå‡ºæ¥ã‚‹ã¨ä¾¿åˆ©ã ãªãƒ¼ã€ã¨æ€ã£ã¦èª¿ã¹ã¦ãŸã‚‰ GitHub Actions ã‚’ä½¿ã£ã¦å®Ÿç¾ã§ããŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

# ä»•çµ„ã¿

äºˆç´„æŠ•ç¨¿ã®ä»•çµ„ã¿ã¯è¨˜äº‹è¿½åŠ ã®**ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ—¥æ™‚æŒ‡å®šã®ãƒžãƒ¼ã‚¸**ã§ã™ã€‚
ãã®å®Ÿç¾ã®ãŸã‚ã«`Merge Schedule`ã¨ã„ã† GitHub Action ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

https://github.com/marketplace/actions/merge-schedule

å‹•ãã¨ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

1. ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šã€å…¬é–‹ã—ãŸã„è¨˜äº‹ã‚’è¿½åŠ ã€‚ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ
2. GitHub Actions ãŒèµ·å‹•ã—ã€Merge Schedule ãŒç™»éŒ²
3. æ—¥æ™‚æŒ‡å®šã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒžãƒ¼ã‚¸ã•ã‚Œã¦ master ãŒæ›´æ–°
4. Zenn ã§è¨˜äº‹ãŒå…¬é–‹

![](https://storage.googleapis.com/zenn-user-upload/8uuxlktwapge6mnn28cvzyu95rec)


# è©³ç´°

## GitHub Actionsã®ç™»éŒ²


Zenn ã®è¨˜äº‹ç®¡ç†ãƒªãƒã‚¸ãƒˆãƒªã«ç§»å‹•ã—ã¦ GitHub Workflow ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã¾ã™ã€‚

```
$ mkdir -p .github/workflows
```

æ¬¡ã« workflows ã«ä»¥ä¸‹`schedule-publish.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚

```yml
name: Merge Schedule
on:
  pull_request:
    types:
      - opened
      - edited
      - synchronize
  schedule:
    - cron: 0 * * * *

jobs:
  merge_schedule:
    runs-on: ubuntu-latest
    steps:
      - uses: gr2m/merge-schedule-action@1ef6893192811edbec08113370a9d973922e84c7
        with:
          time_zone: "Asia/Tokyo"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

ãã—ã¦å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
ã“ã‚Œã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æŠ•ç¨¿ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚

:::message
`gr2m/merge-schedule-actio`ã®æŒ‡å®šã‚’ã‚³ãƒŸãƒƒãƒˆã«ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒŸãƒƒãƒˆã¯ç§ãŒä½œæˆã—ãŸ Time Zone å¯¾å¿œã® PR ãŒãƒžãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã®ã‚³ãƒŸãƒƒãƒˆã§ã™ã€‚2020/11/23 æ™‚ç‚¹ã§ã€ã“ã®ã‚³ãƒŸãƒƒãƒˆãŒæœ€æ–°ã®ãƒªãƒªãƒ¼ã‚¹ã«å–ã‚Šè¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§ã“ã®ã‚ˆã†ãªæŒ‡å®šã¨ã—ã¦ã„ã¾ã™ã€‚
:::

## ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ

ã‚ã¨ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ master ã‹ã‚‰ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šã¾ã™ã€‚

```bash
$ git checkout -b introduce-xvim2
```
ã“ã®ãƒ–ãƒ©ãƒ³ãƒä¸Šã§è¨˜äº‹ã‚’ä½œæˆã—ã¾ã™ã€‚
ä½œæˆãŒå®Œäº†ã—ãŸã‚‰ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```
$ git add introduce-xvim2.md
$ git commmit -m "feat: introduce-xvim2"
$ git push --set-upstream origin introduce-xvim2
```

ãã—ã¦ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ä½œæˆã®éš›ã® Descriptions ã«ä»¥ä¸‹ã®ã‚ˆã†ã« ISO å½¢å¼ã§æŠ•ç¨¿ã—ãŸã„æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒãƒžãƒ¼ã‚¸å®Ÿè¡Œæ—¥æ™‚ã¨ãªã‚Šã¾ã™ã€‚

```
/schedule 2020-11-21T20:00
```

:::message
å½“åˆã€merge-schedule ã¯ã€Descriptions ã«è¨­å®šã—ãŸæ—¥æ™‚ã® UTC æ¨™æº–æ—¥æ™‚ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã„ã†ã‚‚ã®ã§ã—ãŸã€‚
ãã‚Œãžã‚Œã® Time Zone ã§è¨­å®šã§ãã‚‹ã¨ä¾¿åˆ©ã‹ãªã¨æ€ã„ ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ã‚’ä½œã£ãŸã‚‰ç„¡äº‹ãƒžãƒ¼ã‚¸ã—ã¦ã‚‚ã‚‰ãˆã¦ã€ä»Šã¯ã€`with`ã§ Time Zone ã®æŒ‡å®šãŒã§ãã¾ã™ðŸ’ª
https://github.com/gr2m/merge-schedule-action/pull/29
:::


ã“ã®çŠ¶æ…‹ã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã€èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ GitHub Actions ã‚’ã¿ã¦ã¿ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/sn2p1i10c090ykys61xe1me7band)

è©³ç´°ã‚’ã¿ã‚‹ã¨å…ˆã»ã©æŒ‡å®šã—ãŸå…¬é–‹æ—¥æ™‚ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/phk5d1q2y6lvi43bpiki6yjjoukx)

ã‚ã¨ã¯ã€ãã®æŒ‡å®šæ™‚é–“ãŒãã‚‹ã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒžãƒ¼ã‚¸ã•ã‚Œè¨˜äº‹ãŒæŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚
ä¾¿åˆ©ï¼

:::message
Merge Schedule ã® CI ãŒæŠ•ç¨¿å®Œäº†ã¾ã§çµ‚ã‚ã‚‰ãªã„ã®ã§ã€GitHub Actions ã®ç„¡æ–™æž ã‚’ä½™è£•ã§è¶…ãˆã¦ã—ã¾ã†ï¼Ÿã€€ã¨æ€ã£ãŸã®ã§ã™ãŒã€ãã‚Œã¯å¤§ä¸ˆå¤«ã§ã—ãŸã€‚GitHub Actions ã®æ™‚é–“è¨ˆæ¸¬ã®ã‚‚ã®ã¨ã¯åˆ¥æž ã®ã‚ˆã†ã§ã™ã€‚
:::

## ãã®ä»–æ³¨æ„
[merge-schedule](https://github.com/marketplace/actions/merge-schedule)ã® GitHub Actions ãŒã©ã®ã‚ˆã†ã«å‹•ã„ã¦ã„ã‚‹ã®ã‹ã‚’ç¢ºèªã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

https://github.com/gr2m/merge-schedule-action/blob/master/lib/handle_schedule.js

æ³¨ç›®ã™ã‚‹ã®ã¯ä»¥ä¸‹å‡¦ç†ã§ã€

```js
  // ...
  const duePullRequests = pullRequests.filter(
    (pullRequest) => new Date(pullRequest.scheduledDate) < new Date()
  );
  // ...
```

ã©ã†ã‚„ã‚‰ã€cron ã§ã® Actions å®Ÿè¡Œæ™‚ç‚¹ã§ã€scheduleDate ã‚’çµŒéŽã—ã¦ã„ã‚‹ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ½å‡ºã—ã¦ãƒžãƒ¼ã‚¸å®Ÿè¡Œå¯¾è±¡ã¨ã™ã‚‹ã‚ˆã†ã§ã™ã€‚

ãªã®ã§ã€ã‚‚ã—åˆ†å˜ä½ã®å…¬é–‹æŒ‡å®šã‚’ã—ãŸã„å ´åˆã¯ã€GitHub Actions ã® cron ã®æŒ‡å®šã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã®ä¾‹ã ã¨`cron: 0 * * * *`ã§ã€1 æ™‚é–“ã« 1 å›žã—ã‹å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚
ãªã®ã§ã€ä¾‹ãˆ`/schedule 2020-11-21T20:45`ã¨ã€UTC20 æ™‚ 45 åˆ†ã«å®Ÿè¡Œã‚’æŒ‡å®šã—ã¦ã‚‚ã‚‚ã€ãã‚Œã¯`2020-11-21T21:00`ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚‚ã—ã€ã´ã£ãŸã‚Š 45 åˆ†ã«å®Ÿè¡Œã—ã¦æ¬²ã—ã„å ´åˆã¯ cron ã®æŒ‡å®šã‚’`45 * * * *`ã¨ã™ã‚‹ã‹ã€`0/15 * * * *`, `* * * * *`å®Ÿè¡Œãªã©ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã€ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ãã®åˆ† GitHub Actions ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€ äºˆç´„æŠ•ç¨¿æ—¥æ™‚ã«ã‚ˆã£ã¦ã¯ **GitHub Actions ã®å®Ÿè¡Œæ™‚é–“ã®ç„¡æ–™æž ã‚’è¶…éŽã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹** ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚


# ãŠã‚ã‚Šã«

ä»¥ä¸Šã€ŒGitHub Action ã§ Zenn ã®äºˆç´„æŠ•ç¨¿ã‚’å®Ÿç¾ã™ã‚‹ã€ã§ã—ãŸã€‚
ã“ã†ã„ã†å¿œç”¨ãŒåŠ¹ãã®ã‚‚ Zenn ã®è‰¯ã•ã§ã™ã­ã€‚

è‡ªåˆ†ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«çš„ã«æœè¨˜äº‹ã‚’æ›¸ãã‚ã’ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€äºˆç´„æŠ•ç¨¿ã¯ã¨ã¦ã‚‚æ¬²ã—ã‹ã£ãŸæ©Ÿèƒ½ã§ã—ãŸã€‚æ¥æœˆã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚‚ä½¿ãˆã‚‹ã¨æ€ã†ã®ã§æ˜¯éžï¼
