---
title: "2024年、LAPRASのフロントエンド改善活動ふりかえり"
emoji: "📘"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["フロントエンド", "技術的負債"]
published: false
---

この記事は [LAPRAS Advent Calendar 2024](https://qiita.com/advent-calendar/2024/lapras) の17日目の記事です。

https://qiita.com/advent-calendar/2024/lapras


弁護士ドットコムさんの[こちら](https://creators.bengo4.com/entry/2024/12/23/000000)の記事を読んで、「リアルな改善活動が知れる良い記事！LAPRAS版も書いてみたい」と思い書いてみました。

https://creators.bengo4.com/entry/2024/12/23/000000


## 📘 LAPRASのフロントエンド事情

最初にLAPRASのフロントエンド事情の紹介です。

|項目|内容|
|---|---|
|開発開始時期|2016年|
|フロントエンド構成| TypeScript + Vue3 のシンプルなSPA|

実はLAPRASのエンジニア組織にはフロントエンドエンジニアという職種はなく、施策単位で皆バックエンドもフロントエンドも触りながら開発しています。

ただそれだと個別領域の技術的負債の解消が進みにくいので、フロントエンドに興味がある有志のエンジニアがフロントエンド改善委員会という委員会を作り週1回1時間集まって、改善活動を行っています。今回はその委員会で行ってきた改善活動を紹介します。

:::message
委員会の時間以外にもLAPRASにはクリエイティブの時間という、Googleの20%ルールのようなものがあり、その時間にも改善活動を行っています。

- [LAPRASにおける20%ルール的なものとその心｜rocky_manobi](https://note.com/rocky_manobi/n/n619be588790b)
:::


## 🐉 今年行ったフロントエンド改善活動

時系列、規模は順不同で紹介します。

### JestからVitestへの移行

LAPRASのテストは開発当初からJestで行っていました。ただ、JestはES Modulesのサポート問題やパフォーマンスの問題があり、今年Vitestに移行しました。テストケース数は、 件、Jestに依存するテストケースなどもあり簡単に移行はできなかったのですが、なんとかやり遂げました。結果CIのテスト実行時間が、1/3になりリリースのリードタイムの短縮にも繋がりました。ES Modulesのパッチもなくなり、configのメンテナンスも楽になりました。

https://vitest.dev/

### SWRVからTanstackQueryへの完全移行 & VuexのTanStackQueryへの移行

LAPRASでは非同期状態管理ライブラリとして[SWRV](https://docs-swrv.netlify.app/)を昨年から試験的に導入していたのですが、SWRVのメンテナンスが1年以上停滞していることや、SWRVの機能不足を感じて、[TanstackQuery](https://tanstack.com/query)への完全移行を行いました。

また、stale-while-revalidateのキャッシュ戦略によるパフォーマンス改善や実装の複雑さの軽減のため、Vuexの状態管理もTanStackQueryでの非同期状態管理へ移行すべく、現在脱Vuex化へ日々改善を進めています。

https://tanstack.com/query


### webpackからRspackへの移行

ビルド時間やHMRが遅いという問題の解消のため、webpackからRspackへの移行を行いました。Rspackは今年v1.0.0がリリースされたばかりの新しいビルドツールで、導入にははまりどころも色々ありましたが、今はほぼ問題なく動いています。ビルド時間も約1/3になりました。まだ主要プロダクトのひとつはwebpackのままので、そちらも来年にはRspackへの移行を行いたいと思っています。

移行の経緯や導入時のはまりどころについては以下記事で詳しく書いています。

https://zenn.dev/lapras_inc/articles/b2df9989fe2c6e

https://rspack.dev/

### yarn 1系から npm への移行

パッケージマネージャーとして長らくyarn1系を使っていましたが、installのパフォーマンスが悪いこと、yarn2,3,4系へのバージョンアップがつらいことから、npmへの移行を検討しています。ただ、yarnのモジュール解決に依存しているパッケージがあり（非常に良くない・・）、ただnpm installするだけでは動かず、まだ移行できていません。本腰を入れればすぐできると思うので、2025年には移行したいと思っています。

https://yarnpkg.com/

### script setupの布教

Vue2系の頃からVueを使っているので、プロダクトにはOption APIやComposition API、Composition API（script setup）が混在しているのですが、Vue3 + TypeScriptの利点を最大限生かすべく、script setupの布教を行いました。script setup固有の書き方により問題が起こらないか、どのように改善をすすめていくかなどをCoding Guideにまとめました。

https://ja.vuejs.org/api/sfc-script-setup

### AxiosからFetchへの書き換え

Axiosを長らく使っているのですが、Axiosのバージョンが古いことやバンドルサイズの縮小のため、Fetchへの書き換えを行っています。こちらもまだテストケースをまとめている段階で道半ばですが、 2025年には完全移行したいと思っています。

https://developer.mozilla.org/ja/docs/Web/API/Fetch_API

### E2Eテストの導入

LAPRASのフロントエンドテストはユニットテスト + Percyによる簡易なVisualRegressionテストのみで、E2Eテストはありませんでした。今年の初頭まではユニットテストの布教を行ってきたのですが、プロダクトの性質やテストを書くコストとテストで防げる不具合のバランス的に、 E2Eテストに主力をおいた方が良いのでは？という議論が上がり、今はブラウザテストの導入に向けて色々試しています。

現在はVitest Browser Modeによるコンポーネント単位のブラウザテストを試験的に導入しています。

https://vitest.dev/guide/browser/

### Core Web Vitalsの改善

mizchiさんの公開パフォーマンスチューニングの動画の通り


### その他
その他細かい改善活動も並行して行ってきました。

- Vue template部分の型エラー解消
- ESLintのルール追加・修正
- LPサイトのVue導入
- VisualRegressionテストの改善
- Node.jsの継続的アップデートの仕組み作り


# おわりに

改善したいことは山ほどありますが、プロダクトの機能開発と両立して、改善を進めるのは大変です。ただ、フロントエンドの改善活動を進めることで、プロダクトの体験や、エンジニアの開発体験が向上し、周り回って事業の成長につながると信じて、2025年も改善活動を続けていきたいと思います。
おわり。
