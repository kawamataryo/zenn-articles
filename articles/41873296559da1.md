---
title: "Python ã§æ¨™æº–å…¥å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–¹æ³•ï¼ˆunittest, pytestï¼‰"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "unittest", "pytest"]
published: true
---

Pythonã§æ¨™æº–å…¥å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ©Ÿä¼šãŒã‚ã£ãŸã®ã§ãƒ¡ãƒ¢ã€‚

# ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰

ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å¯¾è±¡ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã«ã—ã¾ã™ã€‚
æ¨™æº–å…¥åŠ›ã‹ã‚‰å—ã‘å–ã£ãŸ2ã¤ã®æ•°å­—ã‚’è¶³ã—ãŸç­”ãˆã‚’æ¨™æº–å‡ºåŠ›ã«è¡¨ç¤ºã™ã‚‹é–¢æ•°ã§ã™ã€‚

```python:main.py
def print_sum():
    x = input()
    y = input()
    print(int(x) + int(y))
```

# unittestã§ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

unittestã§ã®æ¨™æº–å…¥å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆã¯ã“ã¡ã‚‰ã§ã™ã€‚

```python:test_main.py
import sys
import io
import unittest


def stub_stdin(testcase_inst, inputs):
    stdin = sys.stdin

    def cleanup():
        sys.stdin = stdin

    testcase_inst.addCleanup(cleanup)
    sys.stdin = io.StringIO(inputs)


def stub_stdouts(testcase_inst):
    stdout = sys.stdout

    def cleanup():
        sys.stdout = stdout

    testcase_inst.addCleanup(cleanup)
    sys.stdout = io.StringIO()


class MainTestCase(unittest.TestCase):
    def test_main(self):
        # æ¨™æº–å…¥åŠ›ã‚’ãƒ¢ãƒƒã‚¯
        stub_stdin(self, "1\n4\n")
        # æ¨™æº–å‡ºåŠ›ã‚’ãƒ¢ãƒƒã‚¯
        stub_stdouts(self)

        print_sum()

        self.assertEqual(sys.stdout.getvalue(), "5\n")
```

stub_stdinã¨stub_stdoutsã§ã€`sys.stdin`ã¨`sys.stdout`ã‚’StringIOã¨å…¥ã‚Œæ›¿ãˆã¦ã„ã¾ã™ã€‚
ãã—ã¦ã€`addCleanup`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã€ãƒ†ã‚¹ãƒˆçµ‚äº†æ™‚ã«ã¯å…ƒã®`sys.stdin`ã¨`sys.stdout`ã«æˆ»ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚


# Pytestã§ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

Pytestã§ã¯unittestã«æ¯”ã¹ã¦å¤§åˆ†ã‚·ãƒ³ãƒ—ãƒ«ã«æ¨™æº–å…¥åŠ›ãƒ»æ¨™æº–å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```python:test_main.py
def test_main(capsys, monkeypatch):
    # æ¨™æº–å…¥åŠ›ã‚’ãƒ¢ãƒƒã‚¯
    monkeypatch.setattr('sys.stdin', io.StringIO("1\n4\n"))

    print_sum()

    # æ¨™æº–å‡ºåŠ›ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’å–å¾—
    captured = capsys.readout()

    assert captured.out == "5\n"
```

monkeypatchã§`sys.stdin`ã‚’mockã—ã¦ã€StringIOã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ãã—ã¦capsysã§æ¨™æº–å…¥åŠ›ã¨æ¨™æº–å‡ºåŠ›ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
ã‚ã¨ã¯ã€ã‚­ãƒ£ãƒ—ãƒãƒ£çµæœã§ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã ã‘ã§OKã§ã™ï¼
åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ï¼

# å‚è€ƒ

https://stackoverflow.com/questions/38861101/how-can-i-test-the-standard-input-and-standard-output-in-python-script-with-a-un

https://docs.pytest.org/en/7.1.x/how-to/capture-stdout-stderr.html