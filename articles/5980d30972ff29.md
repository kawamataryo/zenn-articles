---
title: "[Minecraft Ã— ChatGPT] ãƒã‚¤ã‚¯ãƒ©ã§ä½œã‚ŠãŸã„ã‚‚ã®ã‚’ä¼ãˆã‚‹ã¨é­”æ³•ã¿ãŸã„ã«å®Ÿç¾ã—ã¦ãã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã‚‹"
emoji: "ğŸ’«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["minecraft", "openai", "python"]
published: true
---

:::message
**2023/03/09 è¿½è¨˜**
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½¿ã£ã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿ã«ã¤ã„ã¦åˆ¥é€”è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚
ChatGPTãªã‚‰ã§ã¯ã§ã‹ãªã‚ŠãŠã‚‚ã—ã‚ã„ã®ã§ã€èª­ã‚“ã§ã‚‚ã‚‰ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ï¼
[ChatGPT API ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ã›ã¦ eval ã™ã‚‹éš›ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://zenn.dev/ryo_kawamata/articles/b39ba0452fec81)
:::


æ¯å­ã¨ä¸€ç·’ã«éŠã³ãŸã„ãªã¨ã€Minecraft ã¨ ChatGPT ã‚’ç¹‹ã’ã¦ã€ã‚„ã‚ŠãŸã„ã“ã¨ã‚’æ—¥æœ¬èªã§ä¼ãˆã‚‹ã¨ã„ã„æ„Ÿã˜ã«å®Ÿç¾ã—ã¦ãã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã‚Šã¾ã—ãŸ

# ğŸª„ ä½œã£ãŸã‚‚ã®

`/py magic` ã«ç¶šã‘ã¦ã‚„ã‚ŠãŸã„ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã€ã„ã„æ„Ÿã˜ã«å®Ÿç¾ã—ã¦ãã‚Œã¾ã™ã€‚

**å®¶ã‚’ã¤ãã‚‹ä¾‹**
`/py magic 10ãƒã‚¹å…ˆã«è±ªè¯ãªå®¶ã‚’ä½œã£ã¦ã€‚çª“ã¯åºƒã‚ã§ã€‚`
![](https://i.gyazo.com/d83ec1fd5ba5a4e25e458767882df252.gif =600x)

**æ°´æµã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã‚’ã¤ãã‚‹ä¾‹**
`/py magic æ°´æµã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã‚’ä½œã£ã¦ã€‚å‘¨ã‚Šã¯çŸ³ãƒ–ãƒ­ãƒƒã‚¯ã§ã€‚`
![](https://i.gyazo.com/2aa4c91a4d57a839171e5408631baeb2.gif =600x)

# ğŸ› ï¸ å®Ÿè£…

äº‹å‰ã« Minecraft ã§ Python ã‚’å®Ÿè¡Œã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚

https://files.minecraftforge.net/net/minecraftforge/forge/
https://github.com/arpruss/raspberryjammod

`mcpi` ã§ Minecraft ã«æ¥ç¶šã§ãã‚Œã° OK ã§ã™ã€‚

æ¬¡ã«å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
pip install mistletoe openai mcpi
```

ãã—ã¦ã€`mcpi`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»¥ä¸‹ã‚³ãƒ¼ãƒ‰ã§ `magic.py` ã‚’ä½œã‚Šä¿å­˜ã—ã¾ã™ã€‚

```python:magic.py
import openai
import sys
from mcpi import minecraft
from mistletoe import Document
from mistletoe.block_token import CodeFence
import logging

logging.basicConfig(filename='magic_log.txt', level=logging.INFO)

mc = minecraft.Minecraft.create()


def get_code_blocks(text: str):
    doc = Document(text)

    code_blocks = []
    for token in doc.children:
        if isinstance(token, CodeFence):
            code_blocks.append(token.children[0].content)

    return "\n\n".join(code_blocks)


def think_code(prompt: str, extra_messages=[]): order = f"""
ã€Œ{prompt}ã€ã¨ã„ã†æŒ‡ç¤ºã‚’Minecraftä¸Šã§å®Ÿç¾ã™ã‚‹ãŸã‚ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
Minecraftã¨Pythonã®é€£æºã«ã¯ã€mcpiã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹éš›ã«ã¯ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã£ã¦ãã ã•ã„ã€‚

- å¯èƒ½ãªé™ã‚Šç´°éƒ¨ã¾ã§ç²¾å·§ãªæ§‹ç¯‰ç‰©ã‚’ä½œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹
- å®Œæˆã—ãŸã‚‰æ§‹ç¯‰ç‰©ã®å…¨ä½“ã‚’è¦‹é€šã›ã‚‹ä½ç½®ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç§»å‹•ã•ã›ã‚‹
- ã‚³ãƒ¼ãƒ‰ã¯Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§å›²ã‚€
- Pythonã®execé–¢æ•°ã§å®Ÿè¡Œã§ãã‚‹å½¢å¼ã«ã™ã‚‹

"""

    openai.api_key = "YOUR API KEY"
    try:
        completion = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "ã‚ãªãŸã¯å„ªç§€ãªPythonãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã§ã™ã€‚"},
                {"role": "user", "content": order},
                *extra_messages,
            ]
        )
        return (completion.choices[0].message.content, False)
    except Exception:
        return ("", True)


def main():
    # å¼•æ•°ã‹ã‚‰promptã‚’å–å¾—
    prompt = sys.argv[1]
    mc.postToChat(f"Prompt: {prompt}")

    retry_count = 0
    max_retry_count = 8
    extra_messages = []

    # ä¸€åº¦ã§ã†ã¾ãã„ã‹ãªã„å ´åˆã‚‚ã‚ã‚‹ã®ã§æŒ‡å®šå›æ•°ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹
    while retry_count < max_retry_count:
        # chat completion APIã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        generated_text, has_error = think_code(
            prompt=prompt,
            extra_messages=extra_messages
        )

        if has_error:
            retry_count += 1
            continue

        # APIã®å‡ºåŠ›çµæœã‹ã‚‰ã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§æŠ½å‡º
        code = get_code_blocks(generated_text)

        # ã‚³ãƒ¼ãƒ‰éƒ¨åˆ†ãŒç©ºã®å ´åˆ
        if code == "":
            retry_count += 1
            extra_messages.append({
                "role": "assistant",
                "content": generated_text
            })
            extra_messages.append({
                "role": "user",
                "content": "Minecraftä¸Šã§å®Ÿè¡Œã§ãã‚‹Pythonã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«æ›¸ã„ã¦ãã ã•ã„ã€‚"
            })
            continue

        try:
            # å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’eval
            exec(code, globals())
            mc.postToChat("æˆåŠŸã—ã¾ã—ãŸï¼")
            break
        except Exception as e:
            retry_count += 1
            # evalã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ChatGPTã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«è¿½åŠ ã—ã¦ãƒªãƒˆãƒ©ã‚¤
            extra_messages.append({
                "role": "assistant",
                "content": generated_text
            })
            extra_messages.append({
                "role": "user",
                "content": f"å®Ÿè¡Œã—ãŸã¨ã“ã‚ {e} ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚"
            })
            continue

    if not retry_count < max_retry_count:
        mc.postToChat("Error: å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚")

    logging.info(f"{prompt=}")
    logging.info(f"{generated_text=}")
    logging.info(f"{extra_messages=}")


main()

```

å¼•æ•°ã§å—ã‘å–ã£ãŸ prompt ã‚’ Chat Completion API ã«æ¸¡ã—ã¦ã€ãã®å‡ºåŠ›çµæœã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã¦ exec ã§å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

:::message
ã©ã‚“ãªã‚³ãƒ¼ãƒ‰ãŒè¿”ã£ã¦ãã‚‹ã®ã‹åˆ†ã‹ã‚‰ãªã„ã®ã«ã€exec ã§å®Ÿè¡Œã™ã‚‹ã¨ã„ã†ãƒ¤ãƒã‚ãªå®Ÿè£…ãªã®ã§ã€å®Ÿè¡Œã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ ğŸ™
:::

ã‚ã¨ã¯ã€Minecraft ã«å…¥ã‚Š `/py magic` ã§ã‚„ã‚ŠãŸã“ã¨ã‚’ä¼ãˆã‚‹ã ã‘ã§ã™ã€‚

# ãŠã‚ã‚Šã«

ã¾ã  Prompt ã®è©°ã‚ãŒç”˜ã„ã®ã§ã€ãªã‹ãªã‹ã†ã¾ãå»ºç‰©ã‚’ä½œã£ã¦ãã‚Œãªã„ã“ã¨ãŒå¤šã„ã§ã™ãŒã€æ¯å­ãŒå–œã‚“ã§ãã‚ŒãŸã®ã§ãƒ¨ã‚·ï¼ï¼

https://twitter.com/KawamataRyo/status/1632333351578390528
