---
title: "GitHub Actionã§Zennã®è¨˜äº‹äºˆç´„æŠ•ç¨¿ã‚’å®Ÿç¾ã™ã‚‹"
emoji: "ðŸ“†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GitHub", "GitHubAction", "zenn", "ci"]
published: false
---

ã€ŒZenn ã§è¨˜äº‹ã®äºˆç´„æŠ•ç¨¿ãŒå‡ºæ¥ã‚‹ã¨ä¾¿åˆ©ã ãªãƒ¼ã€ã¨æ€ã£ã¦èª¿ã¹ã¦ãŸã‚‰ GitHub Actions ã‚’ä½¿ã£ã¦å®Ÿç¾ã§ããŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

# ä»•çµ„ã¿

äºˆç´„æŠ•ç¨¿ã®ä»•çµ„ã¿ã¯è¨˜äº‹è¿½åŠ ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ—¥æ™‚æŒ‡å®šã®ãƒžãƒ¼ã‚¸ã§ã™ã€‚
ãã®å®Ÿç¾ã®ãŸã‚ã«`Merge Schedule`ã¨ã„ã† GitHub Action ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

https://github.com/marketplace/actions/merge-schedule

å‹•ãã¨ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

1. ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šã€å…¬é–‹ã—ãŸã„è¨˜äº‹ã‚’åŸ·ç­†ã€‚ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ
2. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ•ãƒƒã‚¯ã« GitHub Actions ãŒèµ·å‹•ã€‚Schedule Merge ã‚’ç™»éŒ²
3. æ—¥æ™‚æŒ‡å®šã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒžãƒ¼ã‚¸ã•ã‚Œã¦ master ãŒæ›´æ–°
4. Zenn ã§è¨˜äº‹ãŒå…¬é–‹

![](https://storage.googleapis.com/zenn-user-upload/8uuxlktwapge6mnn28cvzyu95rec)


# è©³ç´°

## GitHub Actionsã®ç™»éŒ²


Zenn ã®è¨˜äº‹ç®¡ç†ãƒªãƒã‚¸ãƒˆãƒªã«ç§»å‹•ã—ã¦ GitHub Workflow ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã¾ã™ã€‚

```
$ mkdir -p .github/workflows
```

æ¬¡ã« workflows ã«ä»¥ä¸‹`schedule-publish.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚

```yml
name: Schedule Publish
on:
  pull_request:
    types:
      - opened
      - edited
      - synchronize
    schedule:
      - cron: 0 * * * *

jobs:
  merge_schedule:
    runs-on: ubuntu-latest
    steps:
      - uses: gr2m/merge-schedule-action@v1.2.4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

ãã—ã¦å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
ã“ã‚Œã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æŠ•ç¨¿ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚

## ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ

ã‚ã¨ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ master ã‹ã‚‰ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šã¾ã™ã€‚

```bash
$ git checkout -b introduce-xvim2
```
ã“ã®ãƒ–ãƒ©ãƒ³ãƒä¸Šã§è¨˜äº‹ã‚’ä½œæˆã—ã¾ã™ã€‚
ä½œæˆãŒå®Œäº†ã—ãŸã‚‰ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```
$ git add introduce-xvim2.md
$ git commmit -m "feat: introduce-xvim2"
$ git push --set-upstream origin introduce-xvim2
```

ã“ã®æ™‚ã« Descriptions ã«ä»¥ä¸‹ã®ã‚ˆã†ã« ISO å½¢å¼ã§**UTC å”å®šä¸–ç•Œæ™‚**ã§æŠ•ç¨¿ã—ãŸã„æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒãƒžãƒ¼ã‚¸å®Ÿè¡Œæ—¥æ™‚ã¨ãªã‚Šã¾ã™ã€‚

:::message alert
æœ€åˆã€UTC æ¨™æº–æ—¥æ™‚ã§è¨­å®šã™ã‚‹ã¨ã„ã†ã®ã«æ°—ã¥ã‹ãšã€ã€Œå…¨ç„¶ãƒžãƒ¼ã‚¸ã•ã‚Œã‚“ðŸ¤”ã€ã¨æ‚©ã¿ã¾ã—ãŸã€‚
å¿…ãš UTC æ¨™æº–æ—¥æ™‚ã«ç›´ã—ã¦ï¼ˆ-9 æ™‚é–“ï¼‰è¨­å®šã—ã¦ãã ã•ã„ã€‚
:::


```
/schedule 2020-11-21T20:00
```

ã“ã®çŠ¶æ…‹ã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã€èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ GitHub Actions ã‚’ã¿ã¦ã¿ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/sn2p1i10c090ykys61xe1me7band)

è©³ç´°ã‚’ã¿ã‚‹ã¨å…ˆã»ã©æŒ‡å®šã—ãŸå…¬é–‹æ—¥æ™‚ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/phk5d1q2y6lvi43bpiki6yjjoukx)

ã‚ã¨ã¯ã€ãã®æŒ‡å®šæ™‚é–“ãŒãã‚‹ã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒžãƒ¼ã‚¸ã•ã‚Œè¨˜äº‹ãŒæŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

:::message
Merge Schedule ã® CI ãŒæŠ•ç¨¿å®Œäº†ã¾ã§çµ‚ã‚ã‚‰ãªã„ã®ã§ã€GitHub Actions ã®ç„¡æ–™æž ã‚’ä½™è£•ã§è¶…ãˆã¦ã—ã¾ã†ï¼Ÿã€€ã¨æ€ã£ãŸã®ã§ã™ãŒã€ãã‚Œã¯å¤§ä¸ˆå¤«ã§ã—ãŸã€‚GitHub Actions ã®æ™‚é–“è¨ˆæ¸¬ã®ã‚‚ã®ã¨ã¯åˆ¥æž ã§å‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
:::

## ãã®ä»–æ³¨æ„
[merge-schedule](https://github.com/marketplace/actions/merge-schedule)ã® GitHub Actions ãŒã©ã®ã‚ˆã†ã«å‹•ã„ã¦ã„ã‚‹ã®ã‹ç¢ºèªã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

https://github.com/gr2m/merge-schedule-action/blob/master/lib/handle_schedule.js

```js
  // ...
  const duePullRequests = pullRequests.filter(
    (pullRequest) => new Date(pullRequest.scheduledDate) < new Date()
  );
  // ...
```

ã©ã†ã‚„ã‚‰ã€CI å®Ÿè¡Œæ™‚ç‚¹ã§ã€scheduleDate ãŒçµŒéŽã—ã¦ã„ã‚‹ã‚‚ã®ã‚’æŠ½å‡ºã—ã¦ãƒžãƒ¼ã‚¸å®Ÿè¡Œå¯¾è±¡ã¨ã™ã‚‹ã‚ˆã†ã§ã™ã€‚

ãªã®ã§ã€ã‚‚ã—åˆ†å˜ä½ã®å…¬é–‹æŒ‡å®šã‚’ã—ãŸã„å ´åˆã¯ã€GitHub Actions ã® cron ã®æŒ‡å®šã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã®ä¾‹ã ã¨`cron: 0 * * * *`ã§ã€1 æ™‚é–“ã« 1 å›žã—ã‹å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚
ãªã®ã§ã€ä¾‹ãˆ`/schedule 2020-11-21T20:45`ã¨ã€UTC20 æ™‚ 45 åˆ†ã«å®Ÿè¡Œã‚’æŒ‡å®šã—ã¦ã‚‚ã‚‚ã€ãã‚Œã¯`2020-11-21T21:00`ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚‚ã—ã€ã´ã£ãŸã‚Š 45 åˆ†ã«å®Ÿè¡Œã—ã¦æ¬²ã—ã„å ´åˆã¯ cron ã®æŒ‡å®šã‚’`45 * * * *`ã¨ã™ã‚‹ã‹ã€`0/15 * * * *`, `* * * * *`å®Ÿè¡Œãªã©ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã€ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ãã®åˆ† GitHub Actions ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€ äºˆç´„æŠ•ç¨¿æ—¥æ™‚ã«ã‚ˆã£ã¦ã¯ GitHub Actions ã®å®Ÿè¡Œæ™‚é–“ã®ç„¡æ–™æž ã‚’è¶…éŽã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚


# ãŠã‚ã‚Šã«

ä»¥ä¸Šã€ŒGitHub Action ã§ Zenn ã®äºˆç´„æŠ•ç¨¿ã‚’å®Ÿç¾ã™ã‚‹ã€ã§ã—ãŸã€‚
ã“ã†ã„ã†å¿œç”¨ãŒåŠ¹ãã®ã‚‚ Zenn ã®è‰¯ã•ã§ã™ã­ã€‚

è‡ªåˆ†ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«çš„ã«æœè¨˜äº‹ã‚’æ›¸ãã‚ã’ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€äºˆç´„æŠ•ç¨¿ã¯ã¨ã¦ã‚‚æ¬²ã—ã‹ã£ãŸæ©Ÿèƒ½ã§ã—ãŸã€‚ä»Šå¾Œã‚‚ã“ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦è‰²ã€…è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ããŸã„ã§ã™ã€‚