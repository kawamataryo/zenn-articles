---
title: "LAPRASのスコアをクレジットカード風にGitHub Profileに掲載するGitHub Actionsを作った"
emoji: "💳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["githubActions", "typescript", "nextjs"]
published: false
---

この記事は[LAPRAS Advent Calendar 2022](https://qiita.com/advent-calendar/2022/lapras) 22 日目の記事です。最近作った GitHub Actions について書きます。

https://qiita.com/advent-calendar/2022/lapras

# 🛠️ 作ったもの

以下の画像のように LAPRAS のスコアを GitHub Profile にカード画像として表示する GitHub Actions です。
最近ひっそりリリースしていた LAPRAS の公開 API でなにか作れないかな？と思い作成してみました。

![](/images/6e161be042f3d1/2022-12-19-13-21-50.png)

カードのデザインは Generator を使うことで自由に設定可能です。

![](/images/6e161be042f3d1/generator.gif)

https://lapras-card-generator.vercel.app/?e=4.22&b=3.3&i=2.28&b1=%23767676&b2=%23e1e1e1&i1=%23888888&i2=%23cccccc&l=ja

## 設定方法

GitHub Actions の Marketplace で公開しているのですぐ使えます。

https://github.com/marketplace/actions/lapras-card-readme

自分の GitHub Profile リポジトリ `README.md` のカードを表示したい位置に以下のコメントを追加します。

```md
<!--START_SECTION:lapras-card-->
<!--END_SECTION:lapras-card-->
```

そして、`.github/workflows/` に、以下 `lapras-card.yml` を追加し、GitHub Actions を設定します。`SHARE_ID`には、自分の LAPRAS 公開プロフィールの ID を入力します（`https://lapras.com/public/<:share_id>`）。

```yml
name: LAPRAS Card

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

jobs:
  update-card:
    name: LAPRAS Card
    runs-on: ubuntu-latest
    steps:
      - uses: kawamataryo/lapras-card-readme@main
        with:
          SHARE_ID: "<公開ポートフォリオのID>"
          # 以下オプション
          # https://lapras-card-generator.vercel.app でカスタマイズしたデザインを設定可能
          # ICON_FIRST: "#030E21"
          # ICON_SECOND: "#1688BF"
          # BACKGROUND_FIRST: "#020E27"
          # BACKGROUND_SECOND: "#0E5593"
          # LANG: "ja"
          # CARD_WIDTH: "400"
          # UPDATE_TIME: "true"
```

初回は GitHub Actions の **⚠ 手動実行 ⚠️** で画像を追加してください。以降は毎日 12:00(UTC)に更新されます。

![CleanShot 2022-12-12 at 19 51 47](https://user-images.githubusercontent.com/11070996/207027299-5f667477-a812-448b-9997-192f202181d9.png)

# 実装

## 🎨 Generator

## 💳 GitHub Actions

独自の GitHub Actions は、Docker 形式 or JavaScript 形式で作れるのですが、今回は自分が慣れているということもあり JavaScript 形式を選びました。
GitHub 公式で出している以下 template リポジトリを使って開発をスタートしました。

https://github.com/actions/typescript-action

template リポジトリを使ったことで、初期設定に迷わず進められました。

:::message
template リポジトリの node_modules のバージョンがわりと低いので、最初 Warning が多発しました。開発スタート時にすべてアップデートするのが良さそうです。
:::

GitHub Actions 側で行っていることはとても単純です。

1. LAPRAS の公式 API を叩き現在のスコアを取得
2. そのスコアを使って Generator が提供している SVG 画像の URL を組み入れた img タグの文字列を組み立てる
3. GitHub Profile（README.md）の内容を API で取得
4. GitHub Profile に記載している指定のマーカー文字列と 2 で組み立てた img タグの文字列を差し替える
5. GitHub Profile を差し替え結果でコミットする

以下、それらを実施している main.ts のコードです。
最初に GitHub Actions の環境変数から公開プロフィルの ID や、画像のデザインの指定を取得し、1〜5 の流れを行っています。

https://github.com/kawamataryo/lapras-card-readme/blob/main/src/main.ts#L8-L44

マーカー文字列との差し替えという方式は、[waka-readme](https://github.com/athul/waka-readme) を参考にしました。

GitHub Marketplace への公開もとても簡単でした。
以下公式ドキュメントの通りに、リリースを作成するだけで公開が行えました。

https://docs.github.com/ja/actions/creating-actions/publishing-actions-in-github-marketplace

今は手動でリリースを作成しているので、CI でリリースを回すように修正せねば。。と思っています。

# おわりに

はじめての
